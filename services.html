<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-02-05T12:50:51.741754389"><title>Services | Fantasy-Chess Documentation</title><script type="application/json" id="virtual-toc-data">[{"id":"game-state-service","level":0,"title":"Game State Service","anchor":"#game-state-service"},{"id":"lobby-service","level":0,"title":"Lobby Service","anchor":"#lobby-service"},{"id":"player-service","level":0,"title":"Player Service","anchor":"#player-service"},{"id":"token-service","level":0,"title":"Token Service","anchor":"#token-service"},{"id":"websocket-service","level":0,"title":"WebSocket Service","anchor":"#websocket-service"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b575/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Services | Fantasy-Chess Documentation"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Fantasy-Chess Documentation Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/services.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Services | Fantasy-Chess Documentation"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/services.html#webpage",
    "url": "writerside-documentation/services.html",
    "name": "Services | Fantasy-Chess Documentation",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Fantasy-Chess Documentation Help"
}</script><!-- End Schema.org --></head><body data-id="Services" data-main-title="Services" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Technical Reference///Server"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Fantasy-Chess Documentation  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Services" id="Services.md">Services</h1><p id="cn7mx2_3">All services are SpringBoot services classes, which are Singletons within the Server context and can automatically be referenced in fields using dependency Injection. They are the backbone of the server and form the link between incoming requests and the database.</p><dl id="cn7mx2_4" data-style="title-top"><dt id="cn7mx2_10" data-expandable="false">Creating a service</dt><dd><div class="code-block" data-lang="java">
@Service
public class ExampleService{
  // Add one or more repositories to this service
  private final ExampleRepository exampleRepository;
  /* ... */
  public ExampleService( 
      // Springboot automatically wires the created singleton
      // into the constructor witht the Autowired Keyword
      @Autowired ExampleRepository exampleRepository;
  ){
      //Inject the Repository Dependency into the service
      this.exampleRepository = exampleRepository;    
  }
}
</div></dd></dl><section class="chapter"><h2 id="game-state-service" data-toc="game-state-service">Game State Service</h2><p id="cn7mx2_13">Handling all data regarding the game's current state, the Game State Service is arguably the most important of the services. It incorporates the <span id="cn7mx2_17"></span> from the common package. It gathers all commands the player send and then forwards them to the said service. It also rotates the coordinates according to the players view within their browser and sets up new games. Additionally, it provides the ability to query for specific games or see all currently running games.</p><p id="cn7mx2_14">The most important methods include:</p><dl id="cn7mx2_15" data-style="title-top"><dt id="cn7mx2_18" data-expandable="false">startNewGame</dt><dd><p id="cn7mx2_21">Takes in a <code class="code" id="cn7mx2_22">GameSettingsModel</code> instance, the <code class="code" id="cn7mx2_23">lobbyId</code> and the <code class="code" id="cn7mx2_24">playerIds</code> and returns a new Game model as well as saving the newly created game to a hashmap for later reference.</p></dd><dt id="cn7mx2_19" data-expandable="false">processMoves</dt><dd><p id="cn7mx2_26">Takes in a <code class="code" id="cn7mx2_27">gameId</code> along with all move and attack commands made for this turn and processes them, returning a <code class="code" id="cn7mx2_28">TurnResult</code> along with the current <code class="code" id="cn7mx2_29">GridModel</code>.</p></dd></dl><aside class="prompt" data-type="tip" data-title="" id="cn7mx2_16"><p id="cn7mx2_30">For more information, please look at the Java Docs.</p></aside></section><section class="chapter"><h2 id="lobby-service" data-toc="lobby-service">Lobby Service</h2><p id="cn7mx2_31">Used to manage active lobbies and routing players to the correct ones. It exposes basic CRUD operations for lobbies, along with a way to join and leave a lobby. It does not rely on database connections and just saves all lobbies to a <code class="code" id="cn7mx2_34">HashMap</code>. This is done out of simplicity for now, but could be expanded on later to make this service stateless. The HashMap saves instances of <a href="models.html#lobby-model" id="cn7mx2_35" data-tooltip="A data model describing all relevant data for a Lobby.">Lobby Model</a> to later be queried.</p><p id="cn7mx2_32">Some notable methods include:</p><dl id="cn7mx2_33" data-style="title-top"><dt id="cn7mx2_36" data-expandable="false">joinLobby</dt><dd><p id="cn7mx2_40">Takes in the uuid of a lobby and a player id and assigns him to a lobby, granted this doesn't fail.</p></dd><dt id="cn7mx2_37" data-expandable="false">leaveLobby</dt><dd><p id="cn7mx2_42">Given the uuid of a lobby and the player to remove, it removes the player from the lobby and checks, if the player was the host. If it was the host, or there are no more players within the lobby. it automatically closes the lobby.</p></dd><dt id="cn7mx2_38" data-expandable="false">closeLobby</dt><dd><p id="cn7mx2_44">Given the uuid of a lobby and a reason, it closes the lobby and calls the WebSocketService to get the current connected client for all remaining players and sends them a <a href="packet.html#lobby-closed" id="cn7mx2_45" data-tooltip="Indicates that a lobby has been closed">LOBBY_CLOSED</a> packet.</p></dd></dl></section><section class="chapter"><h2 id="player-service" data-toc="player-service">Player Service</h2><p id="cn7mx2_46">The player service handles all data regarding a player's state and information, such as username and userid. It communicates with the Database using the <a href="repositories.html#player-repository" id="cn7mx2_48" data-tooltip="The Player Repository links the to a Table in the database. Along with this, it exposes multiple methods to easily query for a specific player.">Player Repository</a> and exposes methods to get a player, create a new one and set a player's status.</p><aside class="prompt" data-type="tip" data-title="" id="cn7mx2_47"><p id="cn7mx2_49">This service should be expanded upon, once proper authentication has been implemented. For the current state of Authentication see <a href="authentication.html" id="cn7mx2_50" data-tooltip="Within the scope of the MVP, Player's identities are not yet properly secured. They are authenticated once registered but the current implementation does not do authentication when requesting a token. This NEEDS to be addressed for proper production deployment.">Authentication</a>.</p></aside></section><section class="chapter"><h2 id="token-service" data-toc="token-service">Token Service</h2><p id="cn7mx2_51">The token service is used to generate a token for a given user and check its validity.</p><section class="procedure-steps"><h3 id="token-generation" data-toc="token-generation">Token Generation</h3><ol class="list _decimal"><li class="list__item" id="cn7mx2_55"><p>Generate a random 14 character <a href="https://base64.guru/standards/base64url" id="cn7mx2_60" data-external="true" rel="noopener noreferrer">Base64URL</a> string</p></li><li class="list__item" id="cn7mx2_56"><p>Generate the CRC8 checksum for the string and append it to the token.</p></li><li class="list__item" id="cn7mx2_57"><p>Generate the expiry date of the token.</p></li><li class="list__item" id="cn7mx2_58"><p>Assign the token to a player's UUID and add it, along with it's <code class="code" id="cn7mx2_61">expiration</code> into the database.</p></li></ol><p id="cn7mx2_59">In the end, the Token should be written to the database and have a structure, similar to this: <br> <code class="code" id="cn7mx2_63">V3D5qNVl8IpP2y_qEgQ24</code></p></section><section class="procedure-steps"><h3 id="token-validation" data-toc="token-validation">Token Validation</h3><ol class="list _decimal"><li class="list__item" id="cn7mx2_64"><p>Check token for it's CRC8 checksum. Should the CRC8 checksum of the first 14 characters not match with the provided checksum, then discard the token and stop the connection attempt.</p></li><li class="list__item" id="cn7mx2_65"><p>Should the checksum match, then it is safe to assume the token exits in the database, thus fetch the <code class="code" id="cn7mx2_69">expiration</code> and the <code class="code" id="cn7mx2_70">playerId</code> from the <code class="code" id="cn7mx2_71">Token repository</code></p></li><li class="list__item" id="cn7mx2_66"><p>Check if the token is expired and if so, stop the current connection attempt and delete the token from the.</p></li><li class="list__item" id="cn7mx2_67"><p>If all steps succeed, you can safely say, that the token is valid.</p></li></ol><aside class="prompt" data-type="warning" data-title="" id="cn7mx2_68"><p>Tokens are supposed to be used only once, so once a Token was found to be valid, it is to be invalidated right after the required operations with the token have succeeded.</p></aside></section><section class="procedure-steps"><h3 id="token-invalidation" data-toc="token-invalidation">Token Invalidation</h3><p id="cn7mx2_72">To invalidate a token, simply delete it from the <code class="code" id="cn7mx2_73">TokenRepository</code></p><ol class="list _decimal"></ol></section></section><section class="chapter"><h2 id="websocket-service" data-toc="websocket-service">WebSocket Service</h2><p id="cn7mx2_74">The Websocket Service is used for handling all active WebSocket connections and routing the incoming <a href="packet.html" id="cn7mx2_79" data-tooltip="Packets take the form of JSON data and are defined in the code as a Java class, which takes in a JsonDTO. Multiple packets can have the same DTO, however each Type of packet gets an ID, which is unique to that type of packet.">Packets</a> to the correct <a href="packet-handler.html" id="cn7mx2_80" data-tooltip="Packet Handler process incoming WebSocket Packets and implement the PacketHandler interface. The PacketHandler interface defines 2 methods, one for handling the incoming packet and one for it's PacketPattern, which is specific for each Packet Handler and defines the types of packets…">Packet Handler</a>. It stores all currently connected clients within a <code class="code" id="cn7mx2_81">HashMap&lt;String, Client&gt;</code> for quick access. Also housed within the WebSocket Service are the <a href="packet-handler.html" id="cn7mx2_82" data-tooltip="Packet Handler process incoming WebSocket Packets and implement the PacketHandler interface. The PacketHandler interface defines 2 methods, one for handling the incoming packet and one for it's PacketPattern, which is specific for each Packet Handler and defines the types of packets…">Packet Handler</a>, which get assigned to the websocket service inside the constructor.</p><dl id="cn7mx2_75" data-style="title-top"><dt id="cn7mx2_83" data-expandable="false">Registering a Packet Handler in the Websocket Service</dt><dd><div class="code-block" data-lang="java">
public WebSocketService(/* ... */) {
      /* ... */
      addPacketHandler(new ExampleHandler());
      /* ... */
  }
</div></dd></dl><p id="cn7mx2_76">Some of the most important methods exposed by this service include:</p><dl id="cn7mx2_77" data-style="title-top"><dt id="cn7mx2_86" data-expandable="false"><code class="code" id="cn7mx2_90">registerSession(WebSocketSession session, Player player)</code></dt><dd><p id="cn7mx2_89">Given a WebSocket Session and a Player it will link them together and return a new <code class="code" id="cn7mx2_91">Client</code> instance which gets saved to the hashmap. It also adds an OnClientDisconnected listener to the created client, as well as sending the <a href="packet.html#connected-status" id="cn7mx2_92" data-tooltip="Sends the connected status">CONNECTED_STATUS</a> packet to the client to indicate a successful connection.</p></dd><dt id="cn7mx2_87" data-expandable="false"><code class="code" id="cn7mx2_95">handleTextMessage(WebSocketSession session, TextMessage message)</code></dt><dd><p id="cn7mx2_94">Handles incoming messages, figures out, which id they belong to and calls the proper handler given the id in the packet. If the packet is invalid it prints the Stack Trace to the standard console.</p></dd></dl><aside class="prompt" data-type="tip" data-title="" id="cn7mx2_78"><p id="cn7mx2_96">For further information and Methods, please have a look at the <a href="https://fantasy-chess.github.io/javadocs/server/" id="cn7mx2_97" data-external="true" rel="noopener noreferrer">JavaDocs</a>.</p></aside></section><div class="last-modified">Last modified: 05 February 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="controller.html" class="navigation-links__prev">Controller</a><a href="authentication.html" class="navigation-links__next">Authentication</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b575/app.js"></script></body></html>