<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-02-05T20:18:23.885101177"><title>Networking | Fantasy-Chess Documentation</title><script type="application/json" id="virtual-toc-data">[{"id":"websocket-service","level":0,"title":"WebSocket Service","anchor":"#websocket-service"},{"id":"websocket-client","level":0,"title":"WebSocket Client","anchor":"#websocket-client"},{"id":"http-response-callback-listener","level":0,"title":"HTTP Response Callback Listener","anchor":"#http-response-callback-listener"},{"id":"auth","level":0,"title":"Auth","anchor":"#auth"},{"id":"packet-handler","level":0,"title":"Packet Handler","anchor":"#packet-handler"},{"id":"deserialization","level":0,"title":"Deserialization","anchor":"#deserialization"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b575/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Networking | Fantasy-Chess Documentation"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Fantasy-Chess Documentation Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/networking.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Networking | Fantasy-Chess Documentation"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/networking.html#webpage",
    "url": "writerside-documentation/networking.html",
    "name": "Networking | Fantasy-Chess Documentation",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Fantasy-Chess Documentation Help"
}</script><!-- End Schema.org --></head><body data-id="Networking" data-main-title="Networking" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Technical Reference///Client"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Fantasy-Chess Documentation  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Networking" id="Networking.md">Networking</h1><p id="ns6zi4_3"><code class="code" id="ns6zi4_11">Author: Marc Matija</code></p><p id="ns6zi4_4">Clientside networking is handled by the <a href="https://github.com/MrStahlfelge/gdx-websockets" id="ns6zi4_12" data-external="true" rel="noopener noreferrer"><code class="code" id="ns6zi4_13">gdx-websockets</code></a> library</p><section class="chapter"><h2 id="websocket-service" data-toc="websocket-service">WebSocket Service</h2><p id="ns6zi4_14">Forms the backbone of the clientside networking, managing packet routing and client authentication. To facilitate routing, the service makes use of the <code class="code" id="ns6zi4_17">PacketHandler</code> functional interface, which allows inline or outside declaration of handlers.</p><aside class="prompt" data-type="tip" data-title="" id="ns6zi4_15"><p id="ns6zi4_18">Only one Packet handler may be registered per packet at a time.</p></aside><dl id="ns6zi4_16" data-style="title-top"><dt id="ns6zi4_19" data-expandable="false">Registering a Packet Handler</dt><dd><div class="code-block" data-lang="java">
getWebSocketService().addPacketHandler(
  &quot;EXAMPLE_PACKET&quot;,
  (str) -&gt; { 
      // str - Received packet in JSON format: 
      // {&quot;id&quot; : &quot;EXAMPLE_PACKET&quot;, &quot;data&quot; : { ... }} 
      /* ... */ 
  }
);
</div></dd></dl></section><section class="chapter"><h2 id="websocket-client" data-toc="websocket-client">WebSocket Client</h2><p id="ns6zi4_22">An implementation of the <code class="code" id="ns6zi4_25">WebSocketListener</code> from gdx-websocket, which maps method calls to <a href="events.html" id="ns6zi4_26" data-tooltip="Author: Marc Matija">Event</a> invocations. Notable events that get mapped include:</p><ul class="list _bullet" id="ns6zi4_23"><li class="list__item" id="ns6zi4_27"><p><code class="code" id="ns6zi4_31">onOpenEvent</code></p></li><li class="list__item" id="ns6zi4_28"><p><code class="code" id="ns6zi4_32">onCloseEvent</code></p></li><li class="list__item" id="ns6zi4_29"><p><code class="code" id="ns6zi4_33">onErrorEvent</code></p></li><li class="list__item" id="ns6zi4_30"><p><code class="code" id="ns6zi4_34">onTextEvent</code></p></li></ul><p id="ns6zi4_24">This is done for easier access to the exposed methods within the <a href="#websocket-service" id="ns6zi4_35" data-tooltip="Forms the backbone of the clientside networking, managing packet routing and client authentication. To facilitate routing, the service makes use of the PacketHandler functional interface, which allows inline or outside declaration of handlers.">WebSocket Service</a>.</p></section><section class="chapter"><h2 id="http-response-callback-listener" data-toc="http-response-callback-listener">HTTP Response Callback Listener</h2><p id="ns6zi4_36">Maps method exposed by the HttpResponseListener to consumers to be able to dynamically assign them at runtime.</p><p id="ns6zi4_37">Mapped events are:</p><ul class="list _bullet" id="ns6zi4_38"><li class="list__item" id="ns6zi4_39"><p><code class="code" id="ns6zi4_42">handleHttpResponse</code> - a successful HTTP request</p></li><li class="list__item" id="ns6zi4_40"><p><code class="code" id="ns6zi4_43">failed</code> - should the HTTP request fail, or return an error code</p></li><li class="list__item" id="ns6zi4_41"><p><code class="code" id="ns6zi4_44">cancelled</code> - should the response be cancelled on the client</p></li></ul></section><section class="chapter"><h2 id="auth" data-toc="auth">Auth</h2><p id="ns6zi4_45">Handled by sending multiple HTTP requests through the <a href="#http-response-callback-listener" id="ns6zi4_48" data-tooltip="Maps method exposed by the HttpResponseListener to consumers to be able to dynamically assign them at runtime.">HTTP Response Callback Listener</a></p><section class="procedure-steps" id="ns6zi4_46"><ol class="list _decimal"><li class="list__item" id="ns6zi4_49"><p>The user calls <code class="code" id="ns6zi4_55">registerAndConnect</code> passing in the player's username and starting the connection chain.</p></li><li class="list__item" id="ns6zi4_50"><p><code class="code" id="ns6zi4_56">registerClient</code> gets called, sending a POST request to <a href="controller.html#api-v1-register" id="ns6zi4_57" data-tooltip="Endpoint for registering a new user."><code class="code" id="ns6zi4_58">https://{BASEURL}/api/v1/register</code></a> with the players username in the body of the request.</p></li><li class="list__item" id="ns6zi4_51"><p>After obtaining the player's id it gets written to the LibGDX player preferences for later use and passed into the <code class="code" id="ns6zi4_59">getToken</code> method.</p></li><li class="list__item" id="ns6zi4_52"><p>A GET request is sent to <a href="controller.html#api-v1-register" id="ns6zi4_60" data-tooltip="Endpoint for registering a new user."><code class="code" id="ns6zi4_62">https://{BASEURL}/api/v1/register</code></a> with the uuid in the <code class="code" id="ns6zi4_61">X-USER-ID</code> header.</p></li><li class="list__item" id="ns6zi4_53"><p>upon receiving the token, it is written to a variable for later use.</p></li></ol><p id="ns6zi4_54">The client is now authenticated and can connect to the websocket server.</p></section><aside class="prompt" data-type="tip" data-title="" id="ns6zi4_47"><p id="ns6zi4_63">For more information on the Auth Flow, click <a href="authentication.html#auth-flow" id="ns6zi4_64" data-tooltip="Shown is a Sequence diagram of the authentication flow for the server.">here</a></p></aside></section><section class="chapter"><h2 id="packet-handler" data-toc="packet-handler">Packet Handler</h2><p id="ns6zi4_65">A packet handler is a simple FunctionalInterface that accepts the packet as a string and doesn't return anything.</p><div class="code-block" data-lang="java">
@FunctionalInterface
public interface PacketHandler {
    void handle(String packet);
}
</div></section><section class="chapter"><h2 id="deserialization" data-toc="deserialization">Deserialization</h2><p id="ns6zi4_67">Packets get deserialized using LibGDX's built in JsonReader to convert JSON strings into JsonValue instances, that can easily query and extract the data from Json. Each incoming messages needs to be deserialized this way.</p><dl id="ns6zi4_68" data-style="title-top"><dt id="ns6zi4_69" data-expandable="false">Example from <code class="code" id="ns6zi4_72">TurnResultMapper</code></dt><dd><div class="code-block" data-lang="java">
public static TurnResult fromDTO(String str){
  JsonValue value = new JsonReader().parse(str);
  var data = value.get(&quot;data&quot;);
  var characters = CharacterEntityMapper
      .fromListJson(data.get(&quot;updatedCharacters&quot;));
  /* ... */
  var winner = data.getString(&quot;winner&quot;);
  return new TurnResult(characters, conflicts, 
      validMoves, validAttacks,winner);
}
</div></dd></dl></section><div class="last-modified">Last modified: 05 February 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="turnoutcomeanimations.html" class="navigation-links__prev">Turn Outcome Animation</a><a href="tilemap.html" class="navigation-links__next">Tilemap</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b575/app.js"></script></body></html>